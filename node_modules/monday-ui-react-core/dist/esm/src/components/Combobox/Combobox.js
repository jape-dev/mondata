import{slicedToArray as e,defineProperty as o}from"../../../_virtual/_rollupPluginBabelHelpers.js";import{camelCase as t,noop as i,isFunction as s}from"lodash-es";import r from"classnames";import a,{forwardRef as n,useRef as l,useState as c,useCallback as d,useMemo as m}from"react";import{getStyle as p}from"../../helpers/typesciptCssModulesHelper.js";import{getTestId as u,ComponentDefaultTestId as b}from"../../tests/testIds.js";import v from"../../hooks/useMergeRef.js";import f from"../Search/Search.js";import h from"../Button/Button.js";import C from"../Text/Text.js";import g from"./components/ComboboxOption/ComboboxOption.js";import{defaultFilter as x}from"./ComboboxService.js";import{ComboboxItems as I}from"./components/ComboboxItems/ComboboxItems.js";import{StickyCategoryHeader as y}from"./components/StickyCategoryHeader/StickyCategoryHeader.js";import{useItemsData as O,useKeyboardNavigation as N}from"./ComboboxHelpers/ComboboxHelpers.js";import{getOptionId as j}from"./helpers.js";import{withStaticProps as S}from"../../types/withStaticProps.js";import{COMBOBOX_LISTBOX_ID as E}from"./components/ComboboxConstants.js";import k from"./Combobox.module.scss.js";import{BASE_SIZES as F}from"../../constants/sizes.js";var H=n((function(n,g){var S=n.className,F=void 0===S?"":S,R=n.optionClassName,L=void 0===R?"":R,T=n.searchWrapperClassName,M=n.searchIcon,A=n.id,w=void 0===A?"":A,z=n.placeholder,B=void 0===z?"":z,V=n.size,W=void 0===V?H.sizes.MEDIUM:V,P=n.defaultVisualFocusFirstIndex,D=n.optionLineHeight,X=void 0===D?32:D,_=n.optionsListHeight,U=n.autoFocus,Y=void 0!==U&&U,q=n.disabled,G=void 0!==q&&q,J=n.options,K=void 0===J?[]:J,Q=n.categories,Z=n.withCategoriesDivider,$=void 0!==Z&&Z,ee=n.noResultsMessage,oe=void 0===ee?"No results found":ee,te=n.onAddNew,ie=n.addNewLabel,se=void 0===ie?"Add new":ie,re=n.onClick,ae=void 0===re?function(e){}:re,ne=n.filter,le=void 0===ne?x:ne,ce=n.disableFilter,de=void 0!==ce&&ce,me=n.onFilterChanged,pe=n.loading,ue=void 0!==pe&&pe,be=n.onOptionHover,ve=void 0===be?i:be,fe=n.onOptionLeave,he=void 0===fe?i:fe,Ce=n.shouldScrollToSelectedItem,ge=void 0===Ce||Ce,xe=n.noResultsRenderer,Ie=n.stickyCategories,ye=void 0!==Ie&&Ie,Oe=n.optionRenderer,Ne=void 0===Oe?null:Oe,je=n.renderOnlyVisibleOptions,Se=void 0!==je&&je,Ee=n.clearFilterOnSelection,ke=void 0!==Ee&&Ee,Fe=n.maxOptionsWithoutScroll,He=n.defaultFilter,Re=void 0===He?"":He,Le=n.searchInputAriaLabel,Te=void 0===Le?"Search for content":Le,Me=n["data-testid"],Ae=l(null),we=l(null),ze=v(g,Ae),Be=c(Re),Ve=e(Be,2),We=Ve[0],Pe=Ve[1],De=d((function(e){Ge(-1),me&&me(e),Pe(e)}),[Pe,me]),Xe=d((function(e,o,t){ve(e,o,t)}),[ve]),_e=m((function(){return de?K:le(We,K)}),[K,We,le,de]),Ue=c(-1),Ye=e(Ue,2),qe=Ye[0],Ge=Ye[1],Je=d((function(e){return void 0!==e&&_e[e]&&!_e[e].disabled}),[_e]),Ke=d((function(){te&&te(We),Pe("")}),[te,We,Pe]),Qe=_e.length>0,Ze=We.length>0;var $e=c(),eo=e($e,2),oo=eo[0],to=eo[1],io=d((function(e){var o,t;(null===(o=null==e?void 0:e.category)||void 0===o?void 0:o.label)!==oo&&to(null===(t=null==e?void 0:e.category)||void 0===t?void 0:t.label)}),[oo]),so=O({categories:Q,options:_e,filterValue:We,withCategoriesDivider:$,optionLineHeight:X}),ro=so.items,ao=so.itemsMap,no=so.selectableItems,lo=d((function(e,o){ae(no[o]),Je(o)&&Ge(o),ke&&De("")}),[ae,no,Je,ke,De]),co=N({getOptionId:j,defaultVisualFocusFirstIndex:P,onClick:lo,isChildSelectable:Je,options:no,inputRef:we}),mo=co.visualFocusItemIndex,po=co.visualFocusItemId,uo=co.onOptionClick;return a.createElement(C,{type:C.types.TEXT2,ref:ze,className:r(k.combobox,F,p(k,t("size-"+W)),o(o({},k.empty,!Qe),k.stickyCategory,ye)),id:w,"data-testid":Me||u(b.COMBOBOX,w),ellipsis:!1},a.createElement("div",{className:k.comboboxList,style:{maxHeight:_}},a.createElement(f,{ref:we,value:We,className:r(k.comboboxSearchWrapper,T),inputAriaLabel:Te,currentAriaResultId:po,id:"combobox-search",placeholder:B,size:W,disabled:G,onChange:De,autoFocus:Y,loading:ue,searchIconName:M,ariaExpanded:Ze||Qe,ariaHasPopup:"listbox",searchResultsContainerId:w?"".concat(w,"-listbox"):E}),ye&&a.createElement(y,{label:oo}),a.createElement(I,{stickyCategories:ye,categories:Q,options:ro,itemsMap:ao,optionClassName:L,optionRenderer:Ne,activeItemIndex:qe,onActiveCategoryChanged:io,onOptionClick:uo,onOptionEnter:Xe,onOptionLeave:he,optionLineHeight:X,shouldScrollToSelectedItem:ge,renderOnlyVisibleOptions:Se,maxOptionsWithoutScroll:Fe,visualFocusItemIndex:mo,id:w?"".concat(w,"-listbox"):E})),Ze&&!Qe&&!ue&&(xe?xe():a.createElement("div",{className:k.comboboxNoResults},a.createElement("div",{className:k.comboboxMessageWrapper},a.createElement("span",{className:k.comboboxMessage},oe)),te&&!G&&a.createElement(h,{className:k.addNewButton,size:W,kind:h.kinds.TERTIARY,onClick:Ke},a.createElement("span",{className:k.buttonLabel},s(se)?se(We):se)))))})),R=S(H,{sizes:F,iconTypes:g.iconTypes});export{R as default};
//# sourceMappingURL=Combobox.js.map
